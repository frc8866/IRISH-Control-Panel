<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FIRST Robotics Competition Scoreboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/postmatch.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
  <div class="scoreboard">
    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <div class="first-logo">
          <span class="first-text">FIRST</span>
          <span class="dive-text">INNOVATION</span>
          <span class="classroom-text">ROBOTICS</span>
        </div>
      </div>
      <div class="qualification-section">
        <h1>Qualification <span id="match-num">??</span> of ??</h1>
      </div>
      <div class="event-logo">
        <span class="event-text">IRISH Off Season Event</span>
      </div>
    </header>

    <!-- Main Score Section -->
    <main class="main-content">
      <!-- Red Alliance -->
      <section class="red-alliance">
        <div class="alliance-header">
          <h2>Red</h2>
          <div class="alliance-score" id="red-score">??</div>
        </div>
        
        <div class="team-list">
          <div class="team-row">
            <div class="team-number" id="red-team1">????</div>
            <div class="team-rank">?? ↑</div>
          </div>
          <div class="team-row">
            <div class="team-number" id="red-team2">????</div>
            <div class="team-rank">?? ↓</div>
          </div>
        </div>

        <div class="ranking-points-section">
          <h3>Ranking Points</h3>
          <div class="rp-value">??</div>
        </div>
      </section>

      <!-- Center Stats -->
      <section class="center-stats">

        
        <div class="stats-table">
          <div class="stat-row">
            <span class="red-stat">?</span>
            <span class="stat-label">BUCKET</span>
            <span class="blue-stat">?</span>
          </div>
          <div class="stat-row">
            <span class="red-stat">??</span>
            <span class="stat-label">HP</span>
            <span class="blue-stat">???</span>
          </div>
          <div class="stat-row">
            <span class="red-stat">?</span>
            <span class="stat-label">AND ONE BONUS</span>
            <span class="blue-stat">?</span>
          </div>
          <div class="stat-row">
            <span class="red-stat">?</span>
            <span class="stat-label">BENCH</span>
            <span class="blue-stat">?</span>
          </div>
          <div class="stat-row">
            <span class="red-stat">??</span>
            <span class="stat-label">PENALTY</span>
            <span class="blue-stat">?</span>
          </div>
        </div>
      </section>

      <!-- Blue Alliance -->
      <section class="blue-alliance">
        <div class="alliance-header">
          <h2>Blue</h2>
          <div class="alliance-score" id="blue-score">???</div>
        </div>

        <div class="winner-banner">
          <div class="winner-text">WINNER</div>
          <div class="trophy-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20.5C20.78 4 21 4.22 21 4.5S20.78 5 20.5 5H19V6C19 8.76 16.76 11 14 11H13V16L16 18V19H8V18L11 16V11H10C7.24 11 5 8.76 5 6V5H3.5C3.22 5 3 4.78 3 4.5S3.22 4 3.5 4H7Z"/>
            </svg>
          </div>
        </div>

        <div class="event-high-score">
          <div class="star-icon">★</div>
          <span>EVENT HIGH SCORE</span>
          <div class="star-icon">★</div>
        </div>
        
        <div class="team-list">
          <div class="team-row">
            <div class="team-avatar">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="team-number" id="blue-team1">????</div>
            <div class="card-indicator">CARD</div>
            <div class="team-rank">?? ↑</div>
          </div>
          <div class="team-row">
            <div class="team-avatar">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
              </svg>
            </div>
            <div class="team-number" id="blue-team2">????</div>
            <div class="team-rank">? —</div>
          </div>
        </div>

        <div class="ranking-points-section">
          <h3>Ranking Points</h3>
          <div class="rp-value">??</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Load last completed match
    fetch('/api/matches')
      .then(response => response.json())
      .then(matches => {
        const lastMatch = matches.find(m => m.status === 'completed');
        if (lastMatch) {
          document.getElementById('match-num').textContent = lastMatch.match_number;
          document.getElementById('red-team1').textContent = lastMatch.red_team1;
          document.getElementById('red-team2').textContent = lastMatch.red_team2;
          document.getElementById('blue-team1').textContent = lastMatch.blue_team1;
          document.getElementById('blue-team2').textContent = lastMatch.blue_team2;
          document.getElementById('red-score').textContent = lastMatch.red_score;
          document.getElementById('blue-score').textContent = lastMatch.blue_score;

          // Update RP display
          let redRPs = 0;
          let blueRPs = 0;

          if (lastMatch.red_win_rp) redRPs += 2;
          if (lastMatch.blue_win_rp) blueRPs += 2;
          if (lastMatch.red_teleop_rp) redRPs += 1;
          if (lastMatch.blue_teleop_rp) blueRPs += 1;
          if (lastMatch.red_climb_rp) redRPs += 1;
          if (lastMatch.blue_climb_rp) blueRPs += 1;

          // Update RP values in the template
          const redRpElements = document.querySelectorAll('.red-alliance .rp-value');
          const blueRpElements = document.querySelectorAll('.blue-alliance .rp-value');
          redRpElements.forEach(el => el.textContent = redRPs);
          blueRpElements.forEach(el => el.textContent = blueRPs);
        }
      });
  </script>
</body>
</html>